---
name: drift-sqlite-expert
description: Single-database, multi-DAO architecture for Drift (SQLite).
---

# üóÑ DRIFT ARCHITECTURE RULES
Strictly follow the "One Database, Many DAOs" pattern. No multiple .sqlite files.

## ‚ö†Ô∏è –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –®–ê–ë–õ–û–ù–ê
- –®–∞–±–ª–æ–Ω `drift_sqlite_template.dart` ‚Äî —ç—Ç–æ –ü–†–ò–ú–ï–† —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞.
- –í –†–ï–ê–õ–¨–ù–û–ú –ö–û–î–ï:
  1. –í—ã–Ω–æ—Å–∏ `Table` –≤ `features/{name}/data/database/tables.dart`.
  2. –í—ã–Ω–æ—Å–∏ `Dao` –≤ `features/{name}/data/database/dao.dart`.
  3. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π –∏—Ö –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º `lib/core/database/db_client.dart`.


## 1. –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –í DB_CLIENT (CORE)
–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã/DAO:
–î–æ–±–∞–≤—å –∏–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞ —Ç–∞–±–ª–∏—Ü—ã –∏ DAO –≤ db_client.dart.
–î–æ–±–∞–≤—å –∫–ª–∞—Å—Å —Ç–∞–±–ª–∏—Ü—ã –≤ —Å–ø–∏—Å–æ–∫ tables: [...] –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ @DriftDatabase.
–î–æ–±–∞–≤—å –∫–ª–∞—Å—Å DAO –≤ —Å–ø–∏—Å–æ–∫ daos: [...].
–ï—Å–ª–∏ –Ω—É–∂–Ω—ã –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –¥–æ–±–∞–≤—å into(table).insert(...) –≤ MigrationStrategy –≤–Ω—É—Ç—Ä–∏ if (details.wasCreated).

## 2. –ü–†–û–í–ï–†–ö–ê (CHECKLIST)
–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π –Ω–∞–ª–∏—á–∏–µ —Å–∏–º–≤–æ–ª–∞ # –ø–µ—Ä–µ–¥ –∏–º–µ–Ω–µ–º –∫–æ–ª–æ–Ω–∫–∏ –≤ references.
–ò—Å–ø–æ–ª—å–∑—É–π Companion –∫–ª–∞—Å—Å—ã –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π insert –∏ update.
–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–µ–¥–ª–æ–∂–∏ –∑–∞–ø—É—Å–∫: dart run build_runner build --delete-conflicting-outputs.

## 3. –ó–ê–ü–†–ï–¢–´ (RESTRICTIONS)
–ù–ï —Å–æ–∑–¥–∞–≤–∞–π –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω DbClient).
–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π SQL-—Å—Ç—Ä–æ–∫–∏ (—Ç–æ–ª—å–∫–æ Drift Fluent API).
–ù–ï –∑–∞–±—ã–≤–∞–π –ø—Ä–æ part 'db_client.g.dart'; –≤ –≥–ª–∞–≤–Ω–æ–º —Ñ–∞–π–ª–µ.

## ‚å®Ô∏è STANDARDIZED COMMANDS (STRICT)
–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞ –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã:

1. **Build (–û–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫):**
   `dart run build_runner build -d`
   
2. **Watch (–†–µ–∂–∏–º –Ω–∞–±–ª—é–¥–µ–Ω–∏—è):**
   `dart run build_runner watch -d`

3. **Clean (–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç):**
   `dart run build_runner clean`

*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –§–ª–∞–≥ `-d` (—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –æ—Ç `--delete-conflicting-outputs`) –û–ë–Ø–ó–ê–¢–ï–õ–ï–ù –≤–æ –≤—Å–µ—Ö —Å–ª—É—á–∞—è—Ö.*

## üõ† –ü–†–ê–í–ò–õ–ê –î–õ–Ø DbClient (CORE)
–ú–æ–¥–µ–ª—å 8b –¥–æ–ª–∂–Ω–∞ —Å—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ `DbClient`:

## 1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π**:
   - –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–æ–±–∞–≤–ª—è–π –≤ —Å–ø–∏—Å–æ–∫ `tables: [...]`.
   - –ù–æ–≤—ã–µ DAO –¥–æ–±–∞–≤–ª—è–π –≤ —Å–ø–∏—Å–æ–∫ `daos: [...]`.
   - –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `TableClassName` (—Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º Table).

2. **MigrationStrategy (Seeding)**:
   - –ï—Å–ª–∏ —Ñ–∏—á–∞ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –¥–æ–±–∞–≤–ª—è–π –∏—Ö –í–ù–£–¢–†–ò `if (details.wasCreated) { ... }`.
   - –ò—Å–ø–æ–ª—å–∑—É–π `Companion` –∫–ª–∞—Å—Å—ã –¥–ª—è –≤—Å—Ç–∞–≤–æ–∫: `await into(newTable).insert(NewTableCompanion.insert(...))`.

3. **Foreign Keys**:
   - –í—Å–µ–≥–¥–∞ –ø–æ–º–Ω–∏, —á—Ç–æ –≤ `beforeOpen` —É–∂–µ –ø—Ä–æ–ø–∏—Å–∞–Ω–æ `PRAGMA foreign_keys = ON`. –¢–µ–±–µ –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å `.references()` –≤ —Å–∞–º–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö.

4. **Imports**:
   - –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –∏–∑ feature-–ø–∞–ø–∫–∏, –ù–ï –ó–ê–ë–´–í–ê–ô –¥–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç: 
     `import '../features/name/data/database/tables/name_table.dart';`
